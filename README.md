# ğŸ  rasp-shutter

Raspberry Pi ã‚’ä½¿ã£ãŸé›»å‹•ã‚·ãƒ£ãƒƒã‚¿ãƒ¼è‡ªå‹•åˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ 

[![Regression](https://github.com/kimata/rasp-shutter/actions/workflows/regression.yaml/badge.svg)](https://github.com/kimata/rasp-shutter/actions/workflows/regression.yaml)

## ğŸ“‹ æ¦‚è¦

é›»å‹•ã‚·ãƒ£ãƒƒã‚¿ãƒ¼ã‚’ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‚„PCã‹ã‚‰é éš”æ“ä½œã—ã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æ©Ÿèƒ½ã¨å…‰ã‚»ãƒ³ã‚µãƒ¼ã«ã‚ˆã‚‹å®Œå…¨è‡ªå‹•åŒ–ã‚’å®Ÿç¾ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚ESP32ã‚’ä»‹ã—ã¦é›»å‹•ã‚·ãƒ£ãƒƒã‚¿ãƒ¼ã‚’åˆ¶å¾¡ã—ã¾ã™ã€‚

### ä¸»ãªç‰¹å¾´

- ğŸ  **ãƒªãƒ¢ãƒ¼ãƒˆåˆ¶å¾¡** - ã‚¹ãƒãƒ›ã‚„PCã‹ã‚‰ã‚·ãƒ£ãƒƒã‚¿ãƒ¼ã®é–‹é–‰æ“ä½œ
- â° **ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æ©Ÿèƒ½** - æ™‚é–“æŒ‡å®šã§ã®è‡ªå‹•é–‹é–‰
- â˜€ï¸ **å…‰ã‚»ãƒ³ã‚µãƒ¼é€£å‹•** - å±‹å¤–ã®æ˜ã‚‹ã•ã«å¿œã˜ãŸè‡ªå‹•åˆ¶å¾¡
- ğŸ“Š **å±¥æ­´ç®¡ç†** - æ“ä½œå±¥æ­´ã®ä¿å­˜ã¨ç¢ºèª
- ğŸ“± **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–UI** - ãƒ¢ãƒã‚¤ãƒ«ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªWebã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- ğŸŒ¡ï¸ **ã‚»ãƒ³ã‚µãƒ¼æƒ…å ±è¡¨ç¤º** - æ¸©åº¦ãƒ»æ¹¿åº¦ãƒ»ç…§åº¦ã®ç›£è¦–

## ğŸ–¼ï¸ ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ

![ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ](./img/ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ.png)

## ğŸ® ãƒ‡ãƒ¢

å®Ÿéš›ã®å‹•ä½œã‚’ä½“é¨“ã§ãã‚‹ãƒ‡ãƒ¢ã‚µã‚¤ãƒˆï¼š

ğŸ”— https://rasp-shutter-demo.kubernetes.green-rabbit.net/rasp-shutter/

## ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Vue.js 3
- **UIãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: Bootstrap Vue Next
- **ã‚¢ã‚¤ã‚³ãƒ³**: FontAwesome
- **ãƒãƒ£ãƒ¼ãƒˆ**: Chart.js

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Flask (Python)
- **REST API**: ESP32ãƒ‡ãƒã‚¤ã‚¹ã¨ã®é€šä¿¡
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: SQLite
- **ã‚¿ã‚¹ã‚¯ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©**: Python schedule

### ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢

- **åˆ¶å¾¡**: Raspberry Pi + ESP32
- **é›»å‹•ã‚·ãƒ£ãƒƒã‚¿ãƒ¼**: ESP32åˆ¶å¾¡ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
- **ã‚»ãƒ³ã‚µãƒ¼**: å…‰ã‚»ãƒ³ã‚µãƒ¼ï¼ˆæ˜ã‚‹ã•æ¤œçŸ¥ç”¨ï¼‰
- **è©³ç´°**: [ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢æ§‹æˆã®è©³ç´°ã¯ãƒ–ãƒ­ã‚°å‚ç…§](https://rabbit-note.com/2019/03/17/shutter-automation/)

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å¿…è¦ãªç’°å¢ƒ

- Raspberry Pi ã¾ãŸã¯ Linuxç’°å¢ƒ
- Python 3.10+
- Node.js 22.x
- Docker (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)

### 1. ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
sudo apt install npm docker

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¾å­˜é–¢ä¿‚
npm ci
```

### 2. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æº–å‚™

```bash
cp config.example.yaml config.yaml
# config.yaml ã‚’ç’°å¢ƒã«åˆã‚ã›ã¦ç·¨é›†
```

è¨­å®šé …ç›®ã®ä¾‹ï¼š

- ESP32ãƒ‡ãƒã‚¤ã‚¹ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹
- ã‚·ãƒ£ãƒƒã‚¿ãƒ¼åˆ¶å¾¡ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
- ã‚»ãƒ³ã‚µãƒ¼ã®ã—ãã„å€¤
- ãƒ­ã‚°è¨­å®š

## ğŸ’» å®Ÿè¡Œæ–¹æ³•

### Docker ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼ˆæ¨å¥¨ï¼‰

```bash
# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ“ãƒ«ãƒ‰
npm ci
npm run build

# Docker Composeã§èµ·å‹•
docker compose run --build --rm --publish 5000:5000 rasp-shutter
```

### Docker ã‚’ä½¿ç”¨ã—ãªã„å ´åˆ

#### uv ã‚’ä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰

```bash
# uvã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆæœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®å ´åˆï¼‰
curl -LsSf https://astral.sh/uv/install.sh | sh

# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨å®Ÿè¡Œ
uv sync
uv run python flask/src/app.py
```

### é–‹ç™ºãƒ¢ãƒ¼ãƒ‰

```bash
# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã‚µãƒ¼ãƒãƒ¼
npm run dev

# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ï¼‰
uv run python flask/src/app.py -D

# ãƒ€ãƒŸãƒ¼ãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãªã—ã§ãƒ†ã‚¹ãƒˆï¼‰
uv run python flask/src/app.py -d
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆ

```bash
# Pythonãƒ†ã‚¹ãƒˆï¼ˆã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ãï¼‰
uv run pytest

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œ
uv run pytest tests/test_basic.py

# E2Eãƒ†ã‚¹ãƒˆï¼ˆPlaywrightï¼‰
uv run pytest tests/test_playwright.py
```

ãƒ†ã‚¹ãƒˆçµæœï¼š

- HTMLãƒ¬ãƒãƒ¼ãƒˆ: `tests/evidence/index.htm`
- ã‚«ãƒãƒ¬ãƒƒã‚¸: `tests/evidence/coverage/`
- E2EéŒ²ç”»: `tests/evidence/test_*/`

## ğŸ¯ API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### ã‚·ãƒ£ãƒƒã‚¿ãƒ¼åˆ¶å¾¡

- `GET /api/shutter_ctrl` - ã‚·ãƒ£ãƒƒã‚¿ãƒ¼çŠ¶æ…‹å–å¾—
- `POST /api/shutter_ctrl` - ã‚·ãƒ£ãƒƒã‚¿ãƒ¼é–‹é–‰åˆ¶å¾¡

### ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†

- `GET /api/schedule_ctrl` - ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ä¸€è¦§å–å¾—
- `POST /api/schedule_ctrl` - ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¿½åŠ /æ›´æ–°
- `DELETE /api/schedule_ctrl/<id>` - ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å‰Šé™¤

### ã‚»ãƒ³ã‚µãƒ¼æƒ…å ±

- `GET /api/sensor_data` - ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿å–å¾—

### ãƒ­ã‚°ãƒ»å±¥æ­´

- `GET /api/log` - æ“ä½œå±¥æ­´å–å¾—

## â˜¸ï¸ Kubernetes ãƒ‡ãƒ—ãƒ­ã‚¤

Kubernetesç”¨ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ï¼š

```bash
kubectl apply -f kubernetes/rasp-shutter.yaml
```

CronJobã‚’ä½¿ã£ãŸå®šæœŸå®Ÿè¡Œã«ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚è©³ç´°ã¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ã”åˆ©ç”¨ãã ã•ã„ã€‚

## ğŸ”§ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### ã‚·ãƒ£ãƒƒã‚¿ãƒ¼åˆ¶å¾¡ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

ã‚·ãƒ£ãƒƒã‚¿ãƒ¼åˆ¶å¾¡ãƒ­ã‚¸ãƒƒã‚¯ã¯ `flask/src/rasp_shutter/` é…ä¸‹ã§å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚ç•°ãªã‚‹ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢æ§‹æˆã‚„ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«å¯¾å¿œã™ã‚‹å ´åˆã¯ã€ã“ã‚Œã‚‰ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: `src/` é…ä¸‹
- ã‚¹ã‚¿ã‚¤ãƒ«: å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® `.vue` ãƒ•ã‚¡ã‚¤ãƒ«
- è¨­å®š: `vite.config.ts`

## ğŸ“Š CI/CD

GitHub Actions ã«ã‚ˆã‚‹CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼š

- ãƒ†ã‚¹ãƒˆçµæœ: https://kimata.github.io/rasp-shutter/
- ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆ: https://kimata.github.io/rasp-shutter/coverage/

## ğŸ“ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ Apache License Version 2.0 ã®ã‚‚ã¨ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

---

<div align="center">

**â­ ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒå½¹ã«ç«‹ã£ãŸå ´åˆã¯ã€Star ã‚’ãŠé¡˜ã„ã—ã¾ã™ï¼**

[ğŸ› Issue å ±å‘Š](https://github.com/kimata/rasp-shutter/issues) | [ğŸ’¡ Feature Request](https://github.com/kimata/rasp-shutter/issues/new?template=feature_request.md) | [ğŸ“– Wiki](https://github.com/kimata/rasp-shutter/wiki)

</div>
